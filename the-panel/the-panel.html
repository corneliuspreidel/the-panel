<polymer-element name="the-panel" attributes="edge size handle">
  <template>
    <style>
      @host {
        :scope {
          position: fixed;
          overflow: hidden;
        }
      }
    </style>
    <content select="header"></content>
    <content select="main"></content>
    <content select="footer"></content>
  </template>
  <script>
    Polymer('the-panel', {
      edge: 'left',
      size: 200,
      handle: 0,
      enteredView: function () {
        this.observe();
        this.cleanUpLocation();
        this.updateVisibility();
      },
      leftView: function () {
        if (this.observer) {
          this.observer.disconnect();
        }
      },
      edgeChanged: function () {
        this.updateVisibility();
      },
      sizeChanged: function () {
        this.updateVisibility();
      },
      handleChanged: function () {
        this.updateVisibility();
      },
      getMain: function () {
        return this.querySelector('main');
      },
      observe: function () {
        this.observer = new MutationObserver(this.updateVisibility.bind(this));
        this.observer.observe(this.getMain(), {
          subtree: false,
          childList: true,
          attributes: false,
          characterData: false
        });
      },
      getPositionDimension: function () {
        return this.edge;
      },
      getSizeDimensions: function () {
        switch (this.edge) {
          case 'left':
          case 'right':
            return ['width', 'height'];
          case 'top':
          case 'bottom':
            return ['height', 'width'];
        }
      },
      cleanUpLocation: function () {
        this.style.left = '';
        this.style.right = '';
        this.style.top = '';
        this.style.bottom = '';
      },
      updateVisibility: function () {
        var sizeDimensions = this.getSizeDimensions();
        this.style[sizeDimensions[1]] = '100%';
        this.style[sizeDimensions[0]] = this.size + 'px';
        var outside = 0;
        if (this.getMain().childElementCount === 0) {
          outside = (this.size - this.handle) * -1;
        }
        this.style[this.getPositionDimension()] = outside + 'px';
      }
    });
  </script>
</polymer-element>
